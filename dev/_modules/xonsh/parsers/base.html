


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>xonsh.parsers.base &#8212; xonsh 0.9.5.dev135 documentation</title>
    <link rel="stylesheet" href="../../../_static/numpy_friendly.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../../_static/cloud.base.js"></script>
    <script type="text/javascript" src="../../../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../../../_static/magic_conch.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
     
        <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="http://xon.sh/_modules/xonsh/parsers/base.html"/>

  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../../sidebar.html">xonsh 0.9.5.dev135 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for xonsh.parsers.base</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Implements the base xonsh parser.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="k">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">pyparse</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="k">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Mapping</span>

<span class="kn">from</span> <span class="nn">xonsh.ply.ply</span> <span class="k">import</span> <span class="n">yacc</span>

<span class="kn">from</span> <span class="nn">xonsh.tools</span> <span class="k">import</span> <span class="n">FORMATTER</span>
<span class="kn">from</span> <span class="nn">xonsh</span> <span class="k">import</span> <span class="n">ast</span>
<span class="kn">from</span> <span class="nn">xonsh.ast</span> <span class="k">import</span> <span class="n">has_elts</span><span class="p">,</span> <span class="n">xonsh_call</span><span class="p">,</span> <span class="n">load_attribute_chain</span>
<span class="kn">from</span> <span class="nn">xonsh.lexer</span> <span class="k">import</span> <span class="n">Lexer</span><span class="p">,</span> <span class="n">LexToken</span>
<span class="kn">from</span> <span class="nn">xonsh.platform</span> <span class="k">import</span> <span class="n">PYTHON_VERSION_INFO</span>
<span class="kn">from</span> <span class="nn">xonsh.tokenize</span> <span class="k">import</span> <span class="n">SearchPath</span><span class="p">,</span> <span class="n">StringPrefix</span>
<span class="kn">from</span> <span class="nn">xonsh.lazyasd</span> <span class="k">import</span> <span class="n">LazyObject</span><span class="p">,</span> <span class="n">lazyobject</span>
<span class="kn">from</span> <span class="nn">xonsh.parsers.context_check</span> <span class="k">import</span> <span class="n">check_contexts</span>


<span class="n">RE_SEARCHPATH</span> <span class="o">=</span> <span class="n">LazyObject</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">SearchPath</span><span class="p">),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="s2">&quot;RE_SEARCHPATH&quot;</span><span class="p">)</span>
<span class="n">RE_STRINGPREFIX</span> <span class="o">=</span> <span class="n">LazyObject</span><span class="p">(</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">StringPrefix</span><span class="p">),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="s2">&quot;RE_STRINGPREFIX&quot;</span>
<span class="p">)</span>


<span class="nd">@lazyobject</span>
<span class="k">def</span> <span class="nf">RE_FSTR_EVAL_CHARS</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;.*?[!@$`]&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Location</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Location in a file.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes a filename, line number, and optionally a column number.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">lineno</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">:</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">ensure_has_elts</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that x is an AST node with elements.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_elts</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span> <span class="k">if</span> <span class="n">lineno</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lineno</span>
        <span class="n">col_offset</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">col_offset</span> <span class="k">if</span> <span class="n">col_offset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">col_offset</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span><span class="n">elts</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col_offset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">empty_list</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the AST node for an empty list.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">elts</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">binop</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the AST node for a binary operation.&quot;&quot;&quot;</span>
    <span class="n">lineno</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">lineno</span> <span class="k">if</span> <span class="n">lineno</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lineno</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">col_offset</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">col</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">call_split_lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the AST node for calling the &#39;splitlines&#39; attribute of an</span>
<span class="sd">    object, nominally a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
        <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="s2">&quot;splitlines&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
        <span class="p">),</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">starargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
        <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">ensure_list_from_str_or_list</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the AST node for the following expression::</span>

<span class="sd">        [x] if isinstance(x, str) else x</span>

<span class="sd">    Somewhat useful.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">IfExp</span><span class="p">(</span>
        <span class="n">test</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;isinstance&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
            <span class="p">),</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)],</span>
            <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">starargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">body</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">),</span>
        <span class="n">orelse</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
        <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">xonsh_help</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the AST node for calling the __xonsh__.help() function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;__xonsh__.help&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">xonsh_superhelp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the AST node for calling the __xonsh__.superhelp() function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;__xonsh__.superhelp&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">xonsh_pathsearch</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">pymode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the AST node for calling the __xonsh__.pathsearch() function.</span>
<span class="sd">    The pymode argument indicate if it is called from subproc or python mode&quot;&quot;&quot;</span>
    <span class="n">pymode</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">NameConstant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">pymode</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
    <span class="n">searchfunc</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">RE_SEARCHPATH</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
    <span class="n">pathobj</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">searchfunc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">searchfunc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="s2">&quot;g&quot;</span> <span class="ow">in</span> <span class="n">searchfunc</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="s2">&quot;__xonsh__.globsearch&quot;</span>
        <span class="n">pathobj</span> <span class="o">=</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="n">searchfunc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="s2">&quot;__xonsh__.regexsearch&quot;</span>
        <span class="n">pathobj</span> <span class="o">=</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="n">searchfunc</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">load_attribute_chain</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
    <span class="n">pathobj</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">NameConstant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">pathobj</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xonsh_call</span><span class="p">(</span>
        <span class="s2">&quot;__xonsh__.pathsearch&quot;</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">func</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">pymode</span><span class="p">,</span> <span class="n">pathobj</span><span class="p">],</span>
        <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
        <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">load_ctx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Recursively sets ctx to ast.Load()&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;ctx&quot;</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">x</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
            <span class="n">load_ctx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Starred</span><span class="p">):</span>
        <span class="n">load_ctx</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">store_ctx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Recursively sets ctx to ast.Store()&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;ctx&quot;</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">x</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
            <span class="n">store_ctx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Starred</span><span class="p">):</span>
        <span class="n">store_ctx</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">del_ctx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Recursively sets ctx to ast.Del()&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;ctx&quot;</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">x</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Del</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
            <span class="n">del_ctx</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Starred</span><span class="p">):</span>
        <span class="n">del_ctx</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">empty_list_if_newline</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">else</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">lopen_loc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extracts the line and column number for a node that may have an opening</span>
<span class="sd">    parenthesis, brace, or bracket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lineno</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">_lopen_lineno</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;_lopen_lineno&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">lineno</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">_lopen_col</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;_lopen_col&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">col_offset</span>
    <span class="k">return</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span>


<span class="k">def</span> <span class="nf">hasglobstar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True if a node has literal &#39;*&#39; for globbing.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">s</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hasglobstar</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_wrap_fstr_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">conv</span><span class="p">):</span>
    <span class="n">rtn</span> <span class="o">=</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="n">field</span>
    <span class="k">if</span> <span class="n">conv</span><span class="p">:</span>
        <span class="n">rtn</span> <span class="o">+=</span> <span class="s2">&quot;!&quot;</span> <span class="o">+</span> <span class="n">conv</span>
    <span class="k">if</span> <span class="n">spec</span><span class="p">:</span>
        <span class="n">rtn</span> <span class="o">+=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">spec</span>
    <span class="n">rtn</span> <span class="o">+=</span> <span class="s2">&quot;}&quot;</span>
    <span class="k">return</span> <span class="n">rtn</span>


<span class="k">def</span> <span class="nf">eval_fstr_fields</span><span class="p">(</span><span class="n">fstring</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes an fstring (and its prefix, ie f&quot;) that may contain</span>
<span class="sd">    xonsh expressions as its field values and</span>
<span class="sd">    substitues them for a xonsh eval() call as needed. Roughly,</span>
<span class="sd">    for example, this will take f&quot;{$HOME}&quot; and transform it to</span>
<span class="sd">    be f&quot;{__xonsh__.execer.eval(r&#39;$HOME&#39;)}&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">fstring</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\&#39;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">last</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">prelen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">postlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fstring</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">fstring</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">last</span><span class="p">))</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">fstring</span><span class="p">[</span><span class="n">prelen</span><span class="p">:</span><span class="o">-</span><span class="n">postlen</span><span class="p">]</span>
    <span class="n">repl</span> <span class="o">=</span> <span class="n">prefix</span>
    <span class="k">for</span> <span class="n">literal</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">conv</span> <span class="ow">in</span> <span class="n">FORMATTER</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">template</span><span class="p">):</span>
        <span class="n">repl</span> <span class="o">+=</span> <span class="n">literal</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">RE_FSTR_EVAL_CHARS</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># just a normal python field, simply reconstruct.</span>
            <span class="n">repl</span> <span class="o">+=</span> <span class="n">_wrap_fstr_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">conv</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># the field has a special xonsh character, so we must eval it</span>
            <span class="n">eval_field</span> <span class="o">=</span> <span class="s2">&quot;__xonsh__.execer.eval(r&quot;</span> <span class="o">+</span> <span class="n">q</span>
            <span class="n">eval_field</span> <span class="o">+=</span> <span class="n">field</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
            <span class="n">eval_field</span> <span class="o">+=</span> <span class="n">q</span> <span class="o">+</span> <span class="s2">&quot;, glbs=globals(), locs=locals()&quot;</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eval_field</span> <span class="o">+=</span> <span class="s2">&quot;, filename=&quot;</span> <span class="o">+</span> <span class="n">q</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="n">q</span>
            <span class="n">eval_field</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
            <span class="n">repl</span> <span class="o">+=</span> <span class="n">_wrap_fstr_field</span><span class="p">(</span><span class="n">eval_field</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">conv</span><span class="p">)</span>
    <span class="n">repl</span> <span class="o">+=</span> <span class="n">last</span> <span class="o">*</span> <span class="n">postlen</span>
    <span class="k">return</span> <span class="n">repl</span>


<span class="k">class</span> <span class="nc">YaccLoader</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Thread to load (but not shave) the yacc parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">yacc_kwargs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yacc_kwargs</span> <span class="o">=</span> <span class="n">yacc_kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">yacc</span><span class="o">.</span><span class="n">yacc</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">yacc_kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A base class that parses the xonsh language.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lexer_optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">lexer_table</span><span class="o">=</span><span class="s2">&quot;xonsh.lexer_table&quot;</span><span class="p">,</span>
        <span class="n">yacc_optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">yacc_table</span><span class="o">=</span><span class="s2">&quot;xonsh.parser_table&quot;</span><span class="p">,</span>
        <span class="n">yacc_debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">outputdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lexer_optimize : bool, optional</span>
<span class="sd">            Set to false when unstable and true when lexer is stable.</span>
<span class="sd">        lexer_table : str, optional</span>
<span class="sd">            Lexer module used when optimized.</span>
<span class="sd">        yacc_optimize : bool, optional</span>
<span class="sd">            Set to false when unstable and true when parser is stable.</span>
<span class="sd">        yacc_table : str, optional</span>
<span class="sd">            Parser module used when optimized.</span>
<span class="sd">        yacc_debug : debug, optional</span>
<span class="sd">            Dumps extra debug info.</span>
<span class="sd">        outputdir : str or None, optional</span>
<span class="sd">            The directory to place generated tables within. Defaults to the root</span>
<span class="sd">            xonsh dir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span> <span class="o">=</span> <span class="n">Lexer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">tokens</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xonsh_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attach_nocomma_tok_rules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attach_nocloser_base_rules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attach_nodedent_base_rules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attach_nonewline_base_rules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attach_subproc_arg_part_rules</span><span class="p">()</span>

        <span class="n">opt_rules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;newlines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;arglist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;func_call&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rarrow_test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;typedargslist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;equals_test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;colon_test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tfpdef&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_tfpdef_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_pow_tfpdef&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vfpdef&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_vfpdef_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_pow_vfpdef&quot;</span><span class="p">,</span>
            <span class="s2">&quot;equals_yield_expr_or_testlist_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;testlist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;as_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;period_or_ellipsis_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_import_as_name_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_dotted_as_name_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_name_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;elif_part_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;finally_part&quot;</span><span class="p">,</span>
            <span class="s2">&quot;varargslist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;or_and_test_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;and_not_test_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comp_op_expr_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xor_and_expr_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ampersand_shift_expr_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shift_arith_expr_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;op_factor_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trailer_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;testlist_comp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;yield_expr_or_testlist_comp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dictorsetmaker&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_subscript_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sliceop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comp_iter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;yield_arg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_comma_list&quot;</span><span class="p">,</span>
            <span class="s2">&quot;macroarglist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;any_raw_toks&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">opt_rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_opt_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

        <span class="n">list_rules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;comma_tfpdef&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_vfpdef&quot;</span><span class="p">,</span>
            <span class="s2">&quot;semi_small_stmt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_test_or_star_expr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;period_or_ellipsis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_import_as_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_dotted_as_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;period_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;elif_part&quot;</span><span class="p">,</span>
            <span class="s2">&quot;except_part&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_with_item&quot;</span><span class="p">,</span>
            <span class="s2">&quot;or_and_test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;and_not_test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comp_op_expr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pipe_xor_expr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xor_and_expr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ampersand_shift_expr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shift_arith_expr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pm_term&quot;</span><span class="p">,</span>
            <span class="s2">&quot;op_factor&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trailer&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_subscript&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_expr_or_star_expr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_test&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_argument&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_item&quot;</span><span class="p">,</span>
            <span class="s2">&quot;attr_period_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;test_comma&quot;</span><span class="p">,</span>
            <span class="s2">&quot;equals_yield_expr_or_testlist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma_nocomma&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">list_rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_list_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

        <span class="n">tok_rules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;def&quot;</span><span class="p">,</span>
            <span class="s2">&quot;class&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return&quot;</span><span class="p">,</span>
            <span class="s2">&quot;number&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bang&quot;</span><span class="p">,</span>
            <span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ellipsis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;if&quot;</span><span class="p">,</span>
            <span class="s2">&quot;del&quot;</span><span class="p">,</span>
            <span class="s2">&quot;assert&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lparen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lbrace&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lbracket&quot;</span><span class="p">,</span>
            <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="s2">&quot;times&quot;</span><span class="p">,</span>
            <span class="s2">&quot;plus&quot;</span><span class="p">,</span>
            <span class="s2">&quot;minus&quot;</span><span class="p">,</span>
            <span class="s2">&quot;divide&quot;</span><span class="p">,</span>
            <span class="s2">&quot;doublediv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mod&quot;</span><span class="p">,</span>
            <span class="s2">&quot;at&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lshift&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rshift&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pipe&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xor&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ampersand&quot;</span><span class="p">,</span>
            <span class="s2">&quot;for&quot;</span><span class="p">,</span>
            <span class="s2">&quot;colon&quot;</span><span class="p">,</span>
            <span class="s2">&quot;import&quot;</span><span class="p">,</span>
            <span class="s2">&quot;except&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nonlocal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;global&quot;</span><span class="p">,</span>
            <span class="s2">&quot;yield&quot;</span><span class="p">,</span>
            <span class="s2">&quot;from&quot;</span><span class="p">,</span>
            <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
            <span class="s2">&quot;with&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dollar_lparen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dollar_lbrace&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dollar_lbracket&quot;</span><span class="p">,</span>
            <span class="s2">&quot;try&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bang_lparen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bang_lbracket&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comma&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rparen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rbracket&quot;</span><span class="p">,</span>
            <span class="s2">&quot;at_lparen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;atdollar_lparen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;indent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dedent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;newline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lambda&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ampersandequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;as&quot;</span><span class="p">,</span>
            <span class="s2">&quot;atdollar&quot;</span><span class="p">,</span>
            <span class="s2">&quot;atequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;break&quot;</span><span class="p">,</span>
            <span class="s2">&quot;continue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;divequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dollar_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;double_question&quot;</span><span class="p">,</span>
            <span class="s2">&quot;doubledivequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;elif&quot;</span><span class="p">,</span>
            <span class="s2">&quot;else&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;equals&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errortoken&quot;</span><span class="p">,</span>
            <span class="s2">&quot;finally&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ge&quot;</span><span class="p">,</span>
            <span class="s2">&quot;in&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is&quot;</span><span class="p">,</span>
            <span class="s2">&quot;le&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lshiftequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;minusequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ne&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pass&quot;</span><span class="p">,</span>
            <span class="s2">&quot;period&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pipeequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;plusequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;powequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;question&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rarrow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rshiftequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;semi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tilde&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timesequal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;while&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xorequal&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">tok_rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tok_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

        <span class="n">yacc_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">yacc_debug</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="s2">&quot;start_symbols&quot;</span><span class="p">,</span>
            <span class="n">optimize</span><span class="o">=</span><span class="n">yacc_optimize</span><span class="p">,</span>
            <span class="n">tabmodule</span><span class="o">=</span><span class="n">yacc_table</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">yacc_debug</span><span class="p">:</span>
            <span class="n">yacc_kwargs</span><span class="p">[</span><span class="s2">&quot;errorlog&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yacc</span><span class="o">.</span><span class="n">NullLogger</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">outputdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outputdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">yacc_kwargs</span><span class="p">[</span><span class="s2">&quot;outputdir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputdir</span>
        <span class="k">if</span> <span class="n">yacc_debug</span><span class="p">:</span>
            <span class="c1"># create parser on main thread</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">yacc</span><span class="o">.</span><span class="n">yacc</span><span class="p">(</span><span class="o">**</span><span class="n">yacc_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">YaccLoader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yacc_kwargs</span><span class="p">)</span>

        <span class="c1"># Keeps track of the last token given to yacc (the lookahead token)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_yielded_token</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets for clean parsing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_yielded_token</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xonsh_code</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&lt;code&gt;&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;exec&quot;</span><span class="p">,</span> <span class="n">debug_level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an abstract syntax tree of xonsh code.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : str</span>
<span class="sd">            The xonsh code.</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            Name of the file.</span>
<span class="sd">        mode : str, optional</span>
<span class="sd">            Execution mode, one of: exec, eval, or single.</span>
<span class="sd">        debug_level : str, optional</span>
<span class="sd">            Debugging level passed down to yacc.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tree : AST</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xonsh_code</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># block until the parser is ready</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug_level</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">check_contexts</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="c1"># hack for getting modes right</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expression</span><span class="p">):</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Interactive</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Interactive</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">_lexer_errfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currloc</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_yacc_lookahead_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the next-to-last and last token seen by the lexer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">beforelast</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">last</span>

    <span class="k">def</span> <span class="nf">_opt_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rulename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For a rule name, creates an associated optional rule.</span>
<span class="sd">        &#39;_opt&#39; is appended to the rule name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">optfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">optfunc</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_opt : empty</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="s2">&quot;        | </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rulename</span><span class="p">)</span>
        <span class="n">optfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;p_&quot;</span> <span class="o">+</span> <span class="n">rulename</span> <span class="o">+</span> <span class="s2">&quot;_opt&quot;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">optfunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">optfunc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_list_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rulename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For a rule name, creates an associated list rule.</span>
<span class="sd">        &#39;_list&#39; is appended to the rule name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">listfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">listfunc</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_list : </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="s2">&quot;         | </span><span class="si">{0}</span><span class="s2">_list </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">rulename</span>
        <span class="p">)</span>
        <span class="n">listfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;p_&quot;</span> <span class="o">+</span> <span class="n">rulename</span> <span class="o">+</span> <span class="s2">&quot;_list&quot;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">listfunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">listfunc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_tok_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rulename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For a rule name, creates a rule that returns the corresponding token.</span>
<span class="sd">        &#39;_tok&#39; is appended to the rule name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">tokfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yacc_lookahead_token</span><span class="p">()</span>
            <span class="n">uprule</span> <span class="o">=</span> <span class="n">rulename</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">uprule</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">uprule</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;token for </span><span class="si">{0!r}</span><span class="s2"> not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rulename</span><span class="p">))</span>

        <span class="n">tokfunc</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_tok : </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rulename</span><span class="p">,</span> <span class="n">rulename</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">tokfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;p_&quot;</span> <span class="o">+</span> <span class="n">rulename</span> <span class="o">+</span> <span class="s2">&quot;_tok&quot;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">tokfunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">tokfunc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">currloc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current location.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Location</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates an expression for a token.&quot;&quot;&quot;</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">col_offset</span><span class="p">)</span>
        <span class="n">expr</span><span class="o">.</span><span class="n">max_lineno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">expr</span><span class="o">.</span><span class="n">max_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span>
        <span class="k">return</span> <span class="n">expr</span>

    <span class="k">def</span> <span class="nf">token_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets ths token column&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">lexpos</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lineno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">lineno</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">col</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yacc_lookahead_token</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;NEWLINE&quot;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">s</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">token_col</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">xonsh_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xonsh_code</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>

    <span class="k">def</span> <span class="nf">source_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the original source code from two (line, col) tuples in</span>
<span class="sd">        source-space (i.e. lineno start at 1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bline</span><span class="p">,</span> <span class="n">bcol</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">eline</span><span class="p">,</span> <span class="n">ecol</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">bline</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">bline</span><span class="p">:</span><span class="n">eline</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ecol</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">explen</span> <span class="o">=</span> <span class="n">eline</span> <span class="o">-</span> <span class="n">bline</span>
            <span class="k">if</span> <span class="n">explen</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="ow">and</span> <span class="n">explen</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">ecol</span><span class="p">]</span>
        <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">bcol</span><span class="p">:]</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xonsh_code</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">loc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">err_line_pointer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">column</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
            <span class="k">if</span> <span class="n">loc</span><span class="o">.</span><span class="n">lineno</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">loc</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">err_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="n">err_line_pointer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">{: &gt;</span><span class="si">{}</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err_line</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">err_line_pointer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">err_line_pointer</span><span class="p">))</span>
        <span class="n">err</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span>
        <span class="k">raise</span> <span class="n">err</span>

    <span class="c1">#</span>
    <span class="c1"># Precedence of operators</span>
    <span class="c1">#</span>
    <span class="n">precedence</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;PIPE&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;XOR&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;AMPERSAND&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;EQ&quot;</span><span class="p">,</span> <span class="s2">&quot;NE&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;GT&quot;</span><span class="p">,</span> <span class="s2">&quot;GE&quot;</span><span class="p">,</span> <span class="s2">&quot;LT&quot;</span><span class="p">,</span> <span class="s2">&quot;LE&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;RSHIFT&quot;</span><span class="p">,</span> <span class="s2">&quot;LSHIFT&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;PLUS&quot;</span><span class="p">,</span> <span class="s2">&quot;MINUS&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s2">&quot;DIVIDE&quot;</span><span class="p">,</span> <span class="s2">&quot;DOUBLEDIV&quot;</span><span class="p">,</span> <span class="s2">&quot;MOD&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;POW&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Grammar as defined by BNF</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">p_start_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;start_symbols : single_input</span>
<span class="sd">                         | file_input</span>
<span class="sd">                         | eval_input</span>
<span class="sd">                         | empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_single_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;single_input : compound_stmt NEWLINE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">empty_list_if_newline</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Interactive</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_file_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;file_input : file_stmts&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">PYTHON_VERSION_INFO</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">type_ignores</span><span class="o">=</span><span class="p">[])</span>

    <span class="k">def</span> <span class="nf">p_file_stmts_nl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;file_stmts : newline_or_stmt&quot;&quot;&quot;</span>
        <span class="c1"># newline_or_stmt ENDMARKER</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty_list_if_newline</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">p_file_stmts_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;file_stmts : file_stmts newline_or_stmt&quot;&quot;&quot;</span>
        <span class="c1"># file_input newline_or_stmt ENDMARKER</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">empty_list_if_newline</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p2</span>

    <span class="k">def</span> <span class="nf">p_newline_or_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;newline_or_stmt : NEWLINE</span>
<span class="sd">                           | stmt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_newlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;newlines : NEWLINE</span>
<span class="sd">                    | newlines NEWLINE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_eval_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;eval_input : testlist newlines_opt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_func_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;func_call : LPAREN arglist_opt RPAREN&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_attr_period_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;attr_period_name : PERIOD NAME&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_attr_name_alone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;attr_name : name_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_attr_name_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;attr_name : name_tok attr_period_name_list&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">attr</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                <span class="n">attr</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p0</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p0</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_decorator_no_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;decorator : at_tok attr_name NEWLINE&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_decorator_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;decorator : at_tok attr_name func_call NEWLINE&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">p3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">col_offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="k">if</span> <span class="n">p3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">starargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="o">**</span><span class="n">p3</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_decorators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;decorators : decorator</span>
<span class="sd">                      | decorators decorator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_decorated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;decorated : decorators classdef_or_funcdef&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">targ</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">targ</span><span class="o">.</span><span class="n">decorator_list</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="c1"># this is silly, CPython. This claims a func or class starts on</span>
        <span class="c1"># the line of the first decorator, rather than the &#39;def&#39; or &#39;class&#39;</span>
        <span class="c1"># line.  However, it retains the original col_offset.</span>
        <span class="n">targ</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span>
        <span class="c1"># async functions take the col number of the &#39;def&#39;, unless they are</span>
        <span class="c1"># decorated, in which case they have the col of the &#39;async&#39;. WAT?</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">targ</span><span class="p">,</span> <span class="s2">&quot;_async_tok&quot;</span><span class="p">):</span>
            <span class="n">targ</span><span class="o">.</span><span class="n">col_offset</span> <span class="o">=</span> <span class="n">targ</span><span class="o">.</span><span class="n">_async_tok</span><span class="o">.</span><span class="n">lexpos</span>
            <span class="k">del</span> <span class="n">targ</span><span class="o">.</span><span class="n">_async_tok</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p2</span>

    <span class="k">def</span> <span class="nf">p_rarrow_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;rarrow_test : RARROW test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_funcdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;funcdef : def_tok NAME parameters rarrow_test_opt COLON suite&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">args</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">returns</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
            <span class="n">decorator_list</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col_offset</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parameters : LPAREN typedargslist_opt RPAREN&quot;&quot;&quot;</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">kwarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">defaults</span><span class="o">=</span><span class="p">[],</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p2</span>

    <span class="k">def</span> <span class="nf">p_equals_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;equals_test : EQUALS test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_kwarg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : POW tfpdef&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_times4_tfpdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : TIMES tfpdef comma_pow_tfpdef_opt&quot;&quot;&quot;</span>
        <span class="c1"># *args, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_times4_comma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : TIMES comma_pow_tfpdef&quot;&quot;&quot;</span>
        <span class="c1"># *, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_times5_tdpdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : TIMES tfpdef comma_tfpdef_list comma_pow_tfpdef_opt&quot;&quot;&quot;</span>
        <span class="c1"># *args, x, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># *args</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_times5_comma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : TIMES comma_tfpdef_list comma_pow_tfpdef_opt&quot;&quot;&quot;</span>
        <span class="c1"># *, x, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># *args</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_t5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : tfpdef equals_test_opt comma_tfpdef_list_opt comma_opt&quot;&quot;&quot;</span>
        <span class="c1"># x</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_t7</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : tfpdef equals_test_opt comma_tfpdef_list_opt comma_opt POW tfpdef&quot;&quot;&quot;</span>
        <span class="c1"># x, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_t8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : tfpdef equals_test_opt comma_tfpdef_list_opt comma_opt TIMES tfpdef_opt comma_tfpdef_list_opt&quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_t10</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : tfpdef equals_test_opt comma_tfpdef_list_opt comma_opt TIMES tfpdef_opt COMMA POW vfpdef&quot;&quot;&quot;</span>
        <span class="c1"># x, *args, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_typedargslist_t11</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;typedargslist : tfpdef equals_test_opt comma_tfpdef_list_opt comma_opt TIMES tfpdef_opt comma_tfpdef_list COMMA POW tfpdef&quot;&quot;&quot;</span>
        <span class="c1"># x, *args, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
            <span class="n">defaults</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_colon_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;colon_test : COLON test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_tfpdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;tfpdef : name_tok colon_test_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;arg&quot;</span><span class="p">:</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
        <span class="k">if</span> <span class="n">PYTHON_VERSION_INFO</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;lineno&quot;</span><span class="p">:</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="s2">&quot;col_offset&quot;</span><span class="p">:</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">})</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_comma_tfpdef_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_tfpdef : COMMA&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">p_comma_tfpdef_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_tfpdef : COMMA tfpdef equals_test_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;arg&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]}]</span>

    <span class="k">def</span> <span class="nf">p_comma_pow_tfpdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_pow_tfpdef : COMMA POW tfpdef&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_set_args_def</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argmts</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">defs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">argmts</span><span class="o">.</span><span class="n">kwonlyargs</span><span class="p">,</span> <span class="n">argmts</span><span class="o">.</span><span class="n">kw_defaults</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span>
            <span class="k">else</span> <span class="p">(</span><span class="n">argmts</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">argmts</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currloc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span><span class="s2">&quot;named arguments must follow bare *&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;arg&quot;</span><span class="p">])</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="p">(</span><span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">defs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_regular_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># x</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># x=42</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># x, y and x, y=42</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_args_def</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># x=42, y=42</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_args_def</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_var_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">vararg</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vararg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_args_def</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">vararg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># *args</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">vararg</span> <span class="o">=</span> <span class="n">vararg</span>
        <span class="k">elif</span> <span class="n">vararg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># *args, x and *args, x, y and *args, x=10 and *args, x=10, y</span>
            <span class="c1"># and *args, x, y=10, and *args, x=42, y=65</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">vararg</span> <span class="o">=</span> <span class="n">vararg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_args_def</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">p_varargslist_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;varargslist : POW vfpdef&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_varargslist_times4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;varargslist : TIMES vfpdef_opt comma_pow_vfpdef_opt&quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_varargslist_times5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;varargslist : TIMES vfpdef_opt comma_vfpdef_list comma_pow_vfpdef_opt&quot;&quot;&quot;</span>
        <span class="c1"># *args, x, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># *args</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_varargslist_v5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;varargslist : vfpdef equals_test_opt comma_vfpdef_list_opt comma_opt&quot;&quot;&quot;</span>
        <span class="c1"># x</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_varargslist_v7</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;varargslist : vfpdef equals_test_opt comma_vfpdef_list_opt comma_opt POW vfpdef&quot;&quot;&quot;</span>
        <span class="c1"># x, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_varargslist_v8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;varargslist : vfpdef equals_test_opt comma_vfpdef_list_opt comma_opt TIMES vfpdef_opt comma_vfpdef_list_opt&quot;&quot;&quot;</span>
        <span class="c1"># x, *args</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_varargslist_v10</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;varargslist : vfpdef equals_test_opt comma_vfpdef_list_opt comma_opt TIMES vfpdef_opt COMMA POW vfpdef&quot;&quot;&quot;</span>
        <span class="c1"># x, *args, **kwargs</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_varargslist_v11</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;varargslist : vfpdef equals_test_opt comma_vfpdef_list_opt comma_opt TIMES vfpdef_opt comma_vfpdef_list COMMA POW vfpdef&quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">kwarg</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
            <span class="n">defaults</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_regular_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_var_args</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_vfpdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;vfpdef : name_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;arg&quot;</span><span class="p">:</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">PYTHON_VERSION_INFO</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;lineno&quot;</span><span class="p">:</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="s2">&quot;col_offset&quot;</span><span class="p">:</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">})</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_comma_vfpdef_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_vfpdef : COMMA&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">p_comma_vfpdef_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_vfpdef : COMMA vfpdef equals_test_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;arg&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]}]</span>

    <span class="k">def</span> <span class="nf">p_comma_pow_vfpdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_pow_vfpdef : COMMA POW vfpdef&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;stmt : simple_stmt</span>
<span class="sd">                | compound_stmt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_stmt_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;stmt_list : stmt</span>
<span class="sd">                     | stmt_list stmt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_semi_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;semi_opt : SEMI</span>
<span class="sd">                    | empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_semi_small_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;semi_small_stmt : SEMI small_stmt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_simple_stmt_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;simple_stmt : small_stmt semi_opt NEWLINE&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_simple_stmt_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;simple_stmt : small_stmt semi_small_stmt_list semi_opt NEWLINE&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_small_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;small_stmt : expr_stmt</span>
<span class="sd">                      | del_stmt</span>
<span class="sd">                      | pass_stmt</span>
<span class="sd">                      | flow_stmt</span>
<span class="sd">                      | import_stmt</span>
<span class="sd">                      | global_stmt</span>
<span class="sd">                      | nonlocal_stmt</span>
<span class="sd">                      | assert_stmt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">_augassign_op</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;+=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span>
        <span class="s2">&quot;-=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Sub</span><span class="p">,</span>
        <span class="s2">&quot;*=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Mult</span><span class="p">,</span>
        <span class="s2">&quot;@=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">MatMult</span><span class="p">,</span>
        <span class="s2">&quot;/=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span>
        <span class="s2">&quot;%=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Mod</span><span class="p">,</span>
        <span class="s2">&quot;//=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">FloorDiv</span><span class="p">,</span>
        <span class="s2">&quot;**=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Pow</span><span class="p">,</span>
        <span class="s2">&quot;^=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">BitXor</span><span class="p">,</span>
        <span class="s2">&quot;&amp;=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">BitAnd</span><span class="p">,</span>
        <span class="s2">&quot;|=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">BitOr</span><span class="p">,</span>
        <span class="s2">&quot;&lt;&lt;=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">LShift</span><span class="p">,</span>
        <span class="s2">&quot;&gt;&gt;=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">RShift</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">p_expr_stmt_testlist_assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;expr_stmt : testlist_star_expr equals_yield_expr_or_testlist_list_opt</span>
<span class="sd">                     | testlist equals_yield_expr_or_testlist_list_opt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">targ</span> <span class="ow">in</span> <span class="n">p1</span><span class="p">:</span>
                <span class="n">store_ctx</span><span class="p">(</span><span class="n">targ</span><span class="p">)</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">store_ctx</span><span class="p">,</span> <span class="n">p2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                <span class="n">targets</span><span class="o">=</span><span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_expr_stmt_augassign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;expr_stmt : testlist_star_expr augassign yield_expr_or_testlist&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">store_ctx</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_augassign_op</span><span class="p">[</span><span class="n">p2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">op</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span>
                <span class="s2">&quot;operation </span><span class="si">{0!r}</span><span class="s2"> not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currloc</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lexpos</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">AugAssign</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">(),</span> <span class="n">value</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">store_star_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">targs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stores complex unpacking statements that target *x variables.&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">p1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">p1</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">targ</span> <span class="ow">in</span> <span class="n">p1</span><span class="p">:</span>
            <span class="n">store_ctx</span><span class="p">(</span><span class="n">targ</span><span class="p">)</span>
        <span class="n">store_ctx</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">targ</span> <span class="ow">in</span> <span class="n">targs</span><span class="p">:</span>
            <span class="n">store_ctx</span><span class="p">(</span><span class="n">targ</span><span class="p">)</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">targs</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span>
                <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">(),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
            <span class="n">targets</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">col_offset</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_expr_stmt_star5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;expr_stmt : test_comma_list_opt star_expr comma_test_list equals_yield_expr_or_testlist&quot;&quot;&quot;</span>
        <span class="n">targs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_star_expr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">targs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_expr_stmt_star6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;expr_stmt : test_comma_list_opt star_expr comma_opt test_comma_list_opt equals_yield_expr_or_testlist&quot;&quot;&quot;</span>
        <span class="n">targs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[]),</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_star_expr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">targs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_test_comma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;test_comma : test COMMA&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_comma_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_opt : COMMA</span>
<span class="sd">                     | empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_test_or_star_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;test_or_star_expr : test</span>
<span class="sd">                             | star_expr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_comma_test_or_star_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_test_or_star_expr : COMMA test_or_star_expr&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_testlist_star_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;testlist_star_expr : test_or_star_expr comma_test_or_star_expr_list comma_opt</span>
<span class="sd">                              | test_or_star_expr comma_opt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">p2</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                    <span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">],</span>
                    <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                    <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                    <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                    <span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p2</span><span class="p">,</span>
                    <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                    <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                    <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_augassign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;augassign : PLUSEQUAL</span>
<span class="sd">                     | MINUSEQUAL</span>
<span class="sd">                     | TIMESEQUAL</span>
<span class="sd">                     | ATEQUAL</span>
<span class="sd">                     | DIVEQUAL</span>
<span class="sd">                     | MODEQUAL</span>
<span class="sd">                     | AMPERSANDEQUAL</span>
<span class="sd">                     | PIPEEQUAL</span>
<span class="sd">                     | XOREQUAL</span>
<span class="sd">                     | LSHIFTEQUAL</span>
<span class="sd">                     | RSHIFTEQUAL</span>
<span class="sd">                     | POWEQUAL</span>
<span class="sd">                     | DOUBLEDIVEQUAL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_yield_expr_or_testlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;yield_expr_or_testlist : yield_expr</span>
<span class="sd">                                  | testlist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_equals_yield_expr_or_testlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;equals_yield_expr_or_testlist : EQUALS yield_expr_or_testlist&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="c1">#</span>
    <span class="c1"># For normal assignments, additional restrictions enforced</span>
    <span class="c1"># by the interpreter</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="nf">p_del_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;del_stmt : del_tok exprlist&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">targ</span> <span class="ow">in</span> <span class="n">p2</span><span class="p">:</span>
            <span class="n">del_ctx</span><span class="p">(</span><span class="n">targ</span><span class="p">)</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span>
            <span class="n">targets</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Del</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_pass_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;pass_stmt : PASS&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Pass</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_flow_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;flow_stmt : break_stmt</span>
<span class="sd">                     | continue_stmt</span>
<span class="sd">                     | return_stmt</span>
<span class="sd">                     | raise_stmt</span>
<span class="sd">                     | yield_stmt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_break_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;break_stmt : BREAK&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Break</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_continue_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;continue_stmt : CONTINUE&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Continue</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_return_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return_stmt : return_tok testlist_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_yield_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;yield_stmt : yield_expr&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">p_raise_stmt_r1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;raise_stmt : raise_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Raise</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_raise_stmt_r2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;raise_stmt : raise_tok test&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Raise</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cause</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_raise_stmt_r3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;raise_stmt : raise_tok test FROM test&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Raise</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cause</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_import_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_stmt : import_name</span>
<span class="sd">                       | import_from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_import_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_name : import_tok dotted_as_names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Import</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_import_from_pre_f3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_from_pre : from_tok period_or_ellipsis_list&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_import_from_pre_f4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_from_pre : from_tok period_or_ellipsis_list_opt dotted_name&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">p3</span> <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">p2</span> <span class="o">+</span> <span class="n">p3</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_import_from_post_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_from_post : TIMES&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">asname</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">p_import_from_post_as</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_from_post : import_as_names&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_import_from_post_paren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_from_post : LPAREN import_as_names&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_import_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_from : import_from_pre IMPORT import_from_post&quot;&quot;&quot;</span>
        <span class="c1"># note below: the (&#39;.&#39; | &#39;...&#39;) is necessary because &#39;...&#39; is</span>
        <span class="c1"># tokenized as ELLIPSIS</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">lvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">mod</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">(</span>
            <span class="n">module</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">level</span><span class="o">=</span><span class="n">lvl</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_period_or_ellipsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;period_or_ellipsis : PERIOD</span>
<span class="sd">                              | ELLIPSIS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_as_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;as_name : AS NAME&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_import_as_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_as_name : NAME as_name_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">asname</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">p_comma_import_as_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_import_as_name : COMMA import_as_name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_comma_import_as_name_tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_import_as_name : comma_opt RPAREN&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">p_dotted_as_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dotted_as_name : dotted_name as_name_opt&quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">asname</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_comma_dotted_as_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_dotted_as_name : COMMA dotted_as_name&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_import_as_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;import_as_names : import_as_name comma_import_as_name_list_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_dotted_as_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dotted_as_names : dotted_as_name comma_dotted_as_name_list_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_period_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;period_name : PERIOD NAME&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_dotted_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dotted_name : NAME</span>
<span class="sd">                       | NAME period_name_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_comma_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_name : COMMA NAME&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_global_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;global_stmt : global_tok NAME comma_name_list_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">p2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">+=</span> <span class="n">p3</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Global</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_nonlocal_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nonlocal_stmt : nonlocal_tok NAME comma_name_list_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">p2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">+=</span> <span class="n">p3</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Nonlocal</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_comma_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_test : COMMA test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_assert_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;assert_stmt : assert_tok test comma_test_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assert</span><span class="p">(</span><span class="n">test</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">p3</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_compound_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;compound_stmt : if_stmt</span>
<span class="sd">                         | while_stmt</span>
<span class="sd">                         | for_stmt</span>
<span class="sd">                         | try_stmt</span>
<span class="sd">                         | with_stmt</span>
<span class="sd">                         | funcdef</span>
<span class="sd">                         | classdef</span>
<span class="sd">                         | decorated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_elif_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;elif_part : ELIF test COLON suite&quot;&quot;&quot;</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">(</span>
                <span class="n">test</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span>
                <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">orelse</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p2</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p2</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_else_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;else_part : ELSE COLON suite&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_if_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;if_stmt : if_tok test COLON suite elif_part_list_opt</span>
<span class="sd">                   | if_tok test COLON suite elif_part_list_opt else_part</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lastif</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">(</span>
            <span class="n">test</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">orelse</span><span class="o">=</span><span class="p">[],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">lastif</span><span class="p">]</span>
        <span class="n">p5</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">p6</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">p5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">elseif</span> <span class="ow">in</span> <span class="n">p5</span><span class="p">:</span>
                <span class="n">lastif</span><span class="o">.</span><span class="n">orelse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elseif</span><span class="p">)</span>
                <span class="n">lastif</span> <span class="o">=</span> <span class="n">elseif</span>
        <span class="n">lastif</span><span class="o">.</span><span class="n">orelse</span> <span class="o">=</span> <span class="n">p6</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_while_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;while_stmt : WHILE test COLON suite</span>
<span class="sd">                      | WHILE test COLON suite else_part</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p5</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">(</span>
                <span class="n">test</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">orelse</span><span class="o">=</span><span class="n">p5</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_for_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;for_stmt : for_tok exprlist IN testlist COLON suite</span>
<span class="sd">                    | for_tok exprlist IN testlist COLON suite else_part</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p7</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">store_ctx</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p2</span><span class="p">:</span>
                <span class="n">store_ctx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span>
                <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">(),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span>
                <span class="nb">iter</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                <span class="n">orelse</span><span class="o">=</span><span class="n">p7</span><span class="p">,</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_except_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;except_part : except_clause COLON suite&quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_finally_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;finally_part : FINALLY COLON suite&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_try_stmt_t5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;try_stmt : try_tok COLON suite finally_part&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Try</span><span class="p">(</span>
                <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                <span class="n">handlers</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">orelse</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">finalbody</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_try_stmt_t6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;try_stmt : try_tok COLON suite except_part_list finally_part_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Try</span><span class="p">(</span>
                <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                <span class="n">handlers</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">orelse</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">finalbody</span><span class="o">=</span><span class="p">([]</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_try_stmt_t7</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;try_stmt : try_tok COLON suite except_part_list else_part finally_part_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Try</span><span class="p">(</span>
                <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                <span class="n">handlers</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">orelse</span><span class="o">=</span><span class="p">([]</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                <span class="n">finalbody</span><span class="o">=</span><span class="p">([]</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_with_stmt_w5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;with_stmt : with_tok with_item COLON suite&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_with_stmt_p6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;with_stmt : with_tok with_item comma_with_item_list COLON suite&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">(</span>
                <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_with_bang_stmt_single_suite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;with_stmt : with_tok BANG with_item rawsuite&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">p3</span><span class="o">.</span><span class="n">context_expr</span>
        <span class="n">l</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">col_offset</span>
        <span class="n">gblcall</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;globals&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="n">loccall</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;locals&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="n">margs</span> <span class="o">=</span> <span class="p">[</span><span class="n">expr</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">gblcall</span><span class="p">,</span> <span class="n">loccall</span><span class="p">]</span>
        <span class="n">p3</span><span class="o">.</span><span class="n">context_expr</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;__xonsh__.enter_macro&quot;</span><span class="p">,</span> <span class="n">margs</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Pass</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">p4</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p4</span><span class="o">.</span><span class="n">col_offset</span><span class="p">)]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">p3</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">p_with_bang_stmt_many_suite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;with_stmt : with_tok BANG with_item comma_with_item_list rawsuite&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">p5</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">p3</span><span class="p">]</span> <span class="o">+</span> <span class="n">p4</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">context_expr</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">col_offset</span>
            <span class="n">gblcall</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;globals&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
            <span class="n">loccall</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;locals&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
            <span class="n">margs</span> <span class="o">=</span> <span class="p">[</span><span class="n">expr</span><span class="p">,</span> <span class="n">p5</span><span class="p">,</span> <span class="n">gblcall</span><span class="p">,</span> <span class="n">loccall</span><span class="p">]</span>
            <span class="n">item</span><span class="o">.</span><span class="n">context_expr</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.enter_macro&quot;</span><span class="p">,</span> <span class="n">margs</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span>
            <span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Pass</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">p5</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p5</span><span class="o">.</span><span class="n">col_offset</span><span class="p">)]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">With</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_as_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;as_expr : AS expr&quot;&quot;&quot;</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">store_ctx</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p2</span>

    <span class="k">def</span> <span class="nf">p_with_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;with_item : test</span>
<span class="sd">                     | test as_expr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">withitem</span><span class="p">(</span><span class="n">context_expr</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">optional_vars</span><span class="o">=</span><span class="n">p2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_comma_with_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_with_item : COMMA with_item&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_except_clause_e2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;except_clause : except_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ExceptHandler</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_except_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;except_clause : except_tok test as_name_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ExceptHandler</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_suite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;suite : simple_stmt</span>
<span class="sd">                 | NEWLINE INDENT stmt_list DEDENT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_rawsuite_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;rawsuite : COLON NEWLINE indent_tok nodedent dedent_tok&quot;&quot;&quot;</span>
        <span class="n">p3</span><span class="p">,</span> <span class="n">p5</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">beg</span> <span class="o">=</span> <span class="p">(</span><span class="n">p3</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">p5</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p5</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_slice</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">beg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">beg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">p_rawsuite_simple_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;rawsuite : colon_tok nonewline newline_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">beg</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">p3</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_slice</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">beg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">beg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_attach_nodedent_base_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">toks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;DEDENT&quot;</span><span class="p">)</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">       | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">toks</span><span class="p">))</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;nodedent : &quot;</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_nodedent_base</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="k">def</span> <span class="nf">p_nodedent_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="c1"># see above attachment function</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nodedent_any</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nodedent : INDENT any_dedent_toks DEDENT&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nodedent_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nodedent : nodedent nodedent&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_any_dedent_tok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;any_dedent_tok : nodedent</span>
<span class="sd">                          | DEDENT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_any_dedent_toks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;any_dedent_toks : any_dedent_tok</span>
<span class="sd">                           | any_dedent_toks any_dedent_tok</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_attach_nonewline_base_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">toks</span> <span class="o">-=</span> <span class="p">{</span>
            <span class="s2">&quot;NEWLINE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AT_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG_LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATDOLLAR_LPAREN&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">toks</span><span class="p">))</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;nonewline : &quot;</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_nonewline_base</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="k">def</span> <span class="nf">p_nonewline_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="c1"># see above attachment function</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nonewline_any</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nonewline : any_nested_raw&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nonewline_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nonewline : nonewline nonewline&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_test_ol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;test : or_test</span>
<span class="sd">                | lambdef</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_test_o5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;test : or_test IF or_test ELSE test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">IfExp</span><span class="p">(</span>
            <span class="n">test</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">orelse</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_test_nocond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;test_nocond : or_test</span>
<span class="sd">                       | lambdef_nocond</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_lambdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;lambdef : lambda_tok varargslist_opt COLON test&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">kwarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">defaults</span><span class="o">=</span><span class="p">[],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">p4</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_lambdef_nocond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;lambdef_nocond : LAMBDA varargslist_opt COLON test_nocond&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">p_or_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;or_test : and_test or_and_test_list_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">(</span>
                <span class="n">op</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_or_and_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;or_and_test : OR and_test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Or</span><span class="p">(),</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_and_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;and_test : not_test and_not_test_list_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">(</span>
                <span class="n">op</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_and_not_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;and_not_test : AND not_test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">And</span><span class="p">(),</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_not_test_not</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;not_test : NOT not_test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Not</span><span class="p">(),</span> <span class="n">operand</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_not_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;not_test : comparison&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comparison : expr comp_op_expr_list_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span>
                <span class="n">ops</span><span class="o">=</span><span class="n">p2</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">comparators</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_comp_op_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comp_op_expr : comp_op expr&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="n">_comp_ops</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;&lt;&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Lt</span><span class="p">,</span>
        <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Gt</span><span class="p">,</span>
        <span class="s2">&quot;==&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Eq</span><span class="p">,</span>
        <span class="s2">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">GtE</span><span class="p">,</span>
        <span class="s2">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">LtE</span><span class="p">,</span>
        <span class="s2">&quot;!=&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">NotEq</span><span class="p">,</span>
        <span class="s2">&quot;in&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">In</span><span class="p">,</span>
        <span class="p">(</span><span class="s2">&quot;not&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">):</span> <span class="n">ast</span><span class="o">.</span><span class="n">NotIn</span><span class="p">,</span>
        <span class="s2">&quot;is&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Is</span><span class="p">,</span>
        <span class="p">(</span><span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;not&quot;</span><span class="p">):</span> <span class="n">ast</span><span class="o">.</span><span class="n">IsNot</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">p_comp_op_monograph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comp_op : LT</span>
<span class="sd">                   | GT</span>
<span class="sd">                   | EQ</span>
<span class="sd">                   | GE</span>
<span class="sd">                   | LE</span>
<span class="sd">                   | NE</span>
<span class="sd">                   | IN</span>
<span class="sd">                   | IS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comp_ops</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]()</span>

    <span class="k">def</span> <span class="nf">p_comp_op_digraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comp_op : NOT IN</span>
<span class="sd">                   | IS NOT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comp_ops</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])]()</span>

    <span class="k">def</span> <span class="nf">p_star_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;star_expr : times_tok expr&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Starred</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_binop_combine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Combines binary operations&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">):</span>
            <span class="n">p2</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">):</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p0</span><span class="o">.</span><span class="n">col_offset</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">bop</span> <span class="ow">in</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">locer</span> <span class="o">=</span> <span class="n">p1</span> <span class="k">if</span> <span class="n">p0</span><span class="o">.</span><span class="n">left</span> <span class="ow">is</span> <span class="n">p1</span> <span class="k">else</span> <span class="n">p0</span>
                <span class="n">bop</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">p0</span>
                <span class="n">p0</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p0</span><span class="o">.</span><span class="n">col_offset</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">locer</span><span class="p">)</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">bop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span>
        <span class="k">return</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;expr : xor_expr</span>
<span class="sd">                | xor_expr pipe_xor_expr_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop_combine</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_pipe_xor_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;pipe_xor_expr : pipe_tok xor_expr&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">BitOr</span><span class="p">(),</span>
                <span class="n">right</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_xor_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xor_expr : and_expr xor_and_expr_list_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop_combine</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">p_xor_and_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xor_and_expr : xor_tok and_expr&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">BitXor</span><span class="p">(),</span>
                <span class="n">right</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_and_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;and_expr : shift_expr ampersand_shift_expr_list_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop_combine</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">p_ampersand_shift_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ampersand_shift_expr : ampersand_tok shift_expr&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">BitAnd</span><span class="p">(),</span>
                <span class="n">right</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_shift_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shift_expr : arith_expr shift_arith_expr_list_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop_combine</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">p_shift_arith_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shift_arith_expr : lshift_tok arith_expr</span>
<span class="sd">                            | rshift_tok arith_expr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">LShift</span><span class="p">()</span> <span class="k">if</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&lt;&lt;&quot;</span> <span class="k">else</span> <span class="n">ast</span><span class="o">.</span><span class="n">RShift</span><span class="p">()</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_arith_expr_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;arith_expr : term&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_arith_expr_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;arith_expr : term pm_term_list&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p2</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">locer</span> <span class="o">=</span> <span class="n">left</span> <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="n">p1</span> <span class="k">else</span> <span class="n">op</span>
                <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">locer</span><span class="p">)</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
                    <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
                <span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">left</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="n">_term_binops</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span>
        <span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Sub</span><span class="p">,</span>
        <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Mult</span><span class="p">,</span>
        <span class="s2">&quot;@&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">MatMult</span><span class="p">,</span>
        <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span>
        <span class="s2">&quot;%&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Mod</span><span class="p">,</span>
        <span class="s2">&quot;//&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">FloorDiv</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">p_pm_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;pm_term : plus_tok term</span>
<span class="sd">                   | minus_tok term</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_term_binops</span><span class="p">[</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">](</span><span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;term : factor op_factor_list_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p2</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">locer</span> <span class="o">=</span> <span class="n">left</span> <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="n">p1</span> <span class="k">else</span> <span class="n">op</span>
                <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">locer</span><span class="p">)</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
                    <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
                <span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">left</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_op_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;op_factor : times_tok factor</span>
<span class="sd">                     | at_tok factor</span>
<span class="sd">                     | divide_tok factor</span>
<span class="sd">                     | mod_tok factor</span>
<span class="sd">                     | doublediv_tok factor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_term_binops</span><span class="p">[</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">op</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span>
                <span class="s2">&quot;operation </span><span class="si">{0!r}</span><span class="s2"> not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currloc</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lexpos</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">),</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="n">_factor_ops</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">UAdd</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">USub</span><span class="p">,</span> <span class="s2">&quot;~&quot;</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Invert</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">p_factor_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;factor : power&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_factor_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;factor : PLUS factor</span>
<span class="sd">                  | MINUS factor</span>
<span class="sd">                  | TILDE factor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factor_ops</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]()</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">operand</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_power_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;power : atom_expr&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;power : atom_expr POW factor&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span>
            <span class="n">left</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span>
            <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Pow</span><span class="p">(),</span>
            <span class="n">right</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_yield_expr_or_testlist_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;yield_expr_or_testlist_comp : yield_expr</span>
<span class="sd">                                       | testlist_comp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_list_or_elts_if_not_real_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;_real_tuple&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">_real_tuple</span>
        <span class="p">):</span>
            <span class="n">rtn</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">elts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rtn</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">rtn</span>

    <span class="k">def</span> <span class="nf">apply_trailers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leader</span><span class="p">,</span> <span class="n">trailers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function for atom expr.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">trailers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">leader</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">leader</span>
        <span class="k">for</span> <span class="n">trailer</span> <span class="ow">in</span> <span class="n">trailers</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trailer</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Slice</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">ExtSlice</span><span class="p">)):</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">leader</span><span class="p">,</span>
                    <span class="nb">slice</span><span class="o">=</span><span class="n">trailer</span><span class="p">,</span>
                    <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                    <span class="n">lineno</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                    <span class="n">col_offset</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trailer</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
                <span class="c1"># call normal functions</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                    <span class="n">func</span><span class="o">=</span><span class="n">leader</span><span class="p">,</span>
                    <span class="n">lineno</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                    <span class="n">col_offset</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">trailer</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trailer</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="c1"># call macro functions</span>
                <span class="n">l</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">leader</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">leader</span><span class="o">.</span><span class="n">col_offset</span>
                <span class="n">gblcall</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;globals&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
                <span class="n">loccall</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;locals&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trailer</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">trailer</span><span class="p">,</span> <span class="n">arglist</span> <span class="o">=</span> <span class="n">trailer</span>
                <span class="n">margs</span> <span class="o">=</span> <span class="p">[</span><span class="n">leader</span><span class="p">,</span> <span class="n">trailer</span><span class="p">,</span> <span class="n">gblcall</span><span class="p">,</span> <span class="n">loccall</span><span class="p">]</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;__xonsh__.call_macro&quot;</span><span class="p">,</span> <span class="n">margs</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trailer</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">trailer</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_help</span><span class="p">(</span><span class="n">leader</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">col_offset</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">trailer</span> <span class="o">==</span> <span class="s2">&quot;??&quot;</span><span class="p">:</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_superhelp</span><span class="p">(</span>
                        <span class="n">leader</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">col_offset</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">leader</span><span class="p">,</span>
                        <span class="n">attr</span><span class="o">=</span><span class="n">trailer</span><span class="p">,</span>
                        <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                        <span class="n">lineno</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                        <span class="n">col_offset</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span>
            <span class="n">leader</span> <span class="o">=</span> <span class="n">p0</span>
        <span class="k">return</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_atom_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom_expr : atom trailer_list_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_trailers</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1">#</span>
    <span class="c1"># Atom rules! (So does Adam!)</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="nf">p_atom_lparen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : lparen_tok yield_expr_or_testlist_comp_opt RPAREN&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p1_tok</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">p1</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># empty container atom</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
            <span class="p">)</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">_real_tuple</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p2</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">_lopen_lineno</span><span class="p">,</span> <span class="n">p0</span><span class="o">.</span><span class="n">_lopen_col</span> <span class="o">=</span> <span class="n">p1_tok</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1_tok</span><span class="o">.</span><span class="n">lexpos</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">_real_tuple</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">_lopen_lineno</span><span class="p">,</span> <span class="n">p0</span><span class="o">.</span><span class="n">_lopen_col</span> <span class="o">=</span> <span class="n">p1_tok</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1_tok</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_error</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_atom_lbraket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : lbracket_tok testlist_comp_opt RBRACKET&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p1_tok</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">p1</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">GeneratorExp</span><span class="p">):</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ListComp</span><span class="p">(</span>
                <span class="n">elt</span><span class="o">=</span><span class="n">p2</span><span class="o">.</span><span class="n">elt</span><span class="p">,</span>
                <span class="n">generators</span><span class="o">=</span><span class="n">p2</span><span class="o">.</span><span class="n">generators</span><span class="p">,</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p2</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p2</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="s2">&quot;_real_tuple&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p2</span><span class="o">.</span><span class="n">_real_tuple</span><span class="p">:</span>
                    <span class="n">elts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">elts</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">elts</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p2</span><span class="p">]</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="n">elts</span><span class="p">,</span>
                <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1_tok</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1_tok</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_atom_lbrace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : lbrace_tok dictorsetmaker_opt RBRACE&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p1_tok</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">p1</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
                <span class="n">keys</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p2</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p0</span><span class="o">.</span><span class="n">col_offset</span> <span class="o">=</span> <span class="n">p1_tok</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1_tok</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_atom_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : number</span>
<span class="sd">                | string_literal_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_atom_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : name_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_ellip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : ellipsis_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">EllipsisNode</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : none_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">NameConstant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : true_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">NameConstant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_false</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : false_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">NameConstant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_pathsearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : SEARCHPATH&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xonsh_pathsearch</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pymode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_dname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : DOLLAR_NAME&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_envvar_by_name</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_fistful_of_dollars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : dollar_lbrace_tok test RBRACE</span>
<span class="sd">                | bang_lparen_tok subproc RPAREN</span>
<span class="sd">                | dollar_lparen_tok subproc RPAREN</span>
<span class="sd">                | bang_lbracket_tok subproc RBRACKET</span>
<span class="sd">                | dollar_lbracket_tok subproc RBRACKET</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dollar_rules</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_bang_empty_fistful_of_dollars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : bang_lparen_tok subproc bang_tok RPAREN</span>
<span class="sd">                | dollar_lparen_tok subproc bang_tok RPAREN</span>
<span class="sd">                | bang_lbracket_tok subproc bang_tok RBRACKET</span>
<span class="sd">                | dollar_lbracket_tok subproc bang_tok RBRACKET</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_subproc_bang_empty</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dollar_rules</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_atom_bang_fistful_of_dollars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;atom : bang_lparen_tok subproc bang_tok nocloser rparen_tok</span>
<span class="sd">                | dollar_lparen_tok subproc bang_tok nocloser rparen_tok</span>
<span class="sd">                | bang_lbracket_tok subproc bang_tok nocloser rbracket_tok</span>
<span class="sd">                | dollar_lbracket_tok subproc bang_tok nocloser rbracket_tok</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_subproc_bang</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dollar_rules</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_nocloser_base_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">toks</span> <span class="o">-=</span> <span class="p">{</span>
            <span class="s2">&quot;LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AT_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG_LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATDOLLAR_LPAREN&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">       | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">toks</span><span class="p">))</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;nocloser : &quot;</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_nocloser_base</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="k">def</span> <span class="nf">p_nocloser_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="c1"># see above attachment function</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nocloser_any</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nocloser : any_nested_raw&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nocloser_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nocloser : nocloser nocloser&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_string_literal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;string_literal : string_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">RE_STRINGPREFIX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">new_pref</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">value_without_p</span> <span class="o">=</span> <span class="n">new_pref</span> <span class="o">+</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="p">:]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">eval_fstr_fields</span><span class="p">(</span><span class="n">value_without_p</span><span class="p">,</span> <span class="n">new_pref</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">pyparse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">increment_lineno</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.path_literal&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">value_without_p</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="p">:]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span>
                <span class="n">s</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value_without_p</span><span class="p">),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.path_literal&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">eval_fstr_fields</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">pyparse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">increment_lineno</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">is_bytes</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span> <span class="ow">in</span> <span class="n">prefix</span>
            <span class="n">is_raw</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span> <span class="ow">in</span> <span class="n">prefix</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Bytes</span> <span class="k">if</span> <span class="n">is_bytes</span> <span class="k">else</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span> <span class="n">is_raw</span><span class="o">=</span><span class="n">is_raw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_string_literal_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;string_literal_list : string_literal</span>
<span class="sd">                               | string_literal_list string_literal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">s</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">s</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;number : number_tok&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Num</span><span class="p">(</span>
            <span class="n">n</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_testlist_comp_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;testlist_comp : test_or_star_expr comp_for&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">GeneratorExp</span><span class="p">(</span>
            <span class="n">elt</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">generators</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="s2">&quot;comps&quot;</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_testlist_comp_comma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;testlist_comp : test_or_star_expr comma_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># split out grouping parentheses.</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_testlist_comp_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;testlist_comp : test_or_star_expr comma_test_or_star_expr_list comma_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
            <span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p2</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_trailer_lparen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;trailer : LPAREN arglist_opt RPAREN&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span> <span class="n">starargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">p_trailer_bang_lparen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;trailer : bang_lparen_tok macroarglist_opt rparen_tok</span>
<span class="sd">                   | bang_lparen_tok nocomma comma_tok rparen_tok</span>
<span class="sd">                   | bang_lparen_tok nocomma comma_tok WS rparen_tok</span>
<span class="sd">                   | bang_lparen_tok macroarglist comma_tok rparen_tok</span>
<span class="sd">                   | bang_lparen_tok macroarglist comma_tok WS rparen_tok</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">begins</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">ends</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p3</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">p2</span><span class="p">:</span>
            <span class="n">begins</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p2</span><span class="p">])</span>
            <span class="n">ends</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">+</span> <span class="n">ends</span>
        <span class="n">elts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">beg</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">begins</span><span class="p">,</span> <span class="n">ends</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_slice</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">begins</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;empty macro arguments not allowed&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currloc</span><span class="p">(</span><span class="o">*</span><span class="n">beg</span><span class="p">))</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">beg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">beg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">elts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
            <span class="n">elts</span><span class="o">=</span><span class="n">elts</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_trailer_p3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;trailer : LBRACKET subscriptlist RBRACKET</span>
<span class="sd">                   | PERIOD NAME</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_trailer_quest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;trailer : DOUBLE_QUESTION</span>
<span class="sd">                   | QUESTION</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_attach_nocomma_tok_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">toks</span> <span class="o">-=</span> <span class="p">{</span>
            <span class="s2">&quot;COMMA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AT_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG_LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATDOLLAR_LPAREN&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">            | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">toks</span><span class="p">))</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;nocomma_tok : &quot;</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_nocomma_tok</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="c1"># The following grammar rules are no-ops because we don&#39;t need to glue the</span>
    <span class="c1"># source code back together piece-by-piece. Instead, we simply look for</span>
    <span class="c1"># top-level commas and record their positions. With these positions and the</span>
    <span class="c1"># respective positions of the bounding parentheses, we can use the</span>
    <span class="c1"># source_slice() method. This does a much better job of capturing exactly</span>
    <span class="c1"># the source code that was provided. The tokenizer &amp; lexer can be a little</span>
    <span class="c1"># lossy, especially with respect to whitespace.</span>

    <span class="k">def</span> <span class="nf">p_nocomma_tok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="c1"># see attachment function above for docstring</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_any_raw_tok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;any_raw_tok : nocomma</span>
<span class="sd">                       | COMMA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_any_raw_toks_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;any_raw_toks : any_raw_tok&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_any_raw_toks_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;any_raw_toks : any_raw_toks any_raw_tok&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nocomma_part_tok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nocomma_part : nocomma_tok&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_any_nested_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;any_nested_raw : LPAREN any_raw_toks_opt RPAREN</span>
<span class="sd">                          | LBRACE any_raw_toks_opt RBRACE</span>
<span class="sd">                          | LBRACKET any_raw_toks_opt RBRACKET</span>
<span class="sd">                          | AT_LPAREN any_raw_toks_opt RPAREN</span>
<span class="sd">                          | BANG_LPAREN any_raw_toks_opt RPAREN</span>
<span class="sd">                          | BANG_LBRACKET any_raw_toks_opt RBRACKET</span>
<span class="sd">                          | DOLLAR_LPAREN any_raw_toks_opt RPAREN</span>
<span class="sd">                          | DOLLAR_LBRACE any_raw_toks_opt RBRACE</span>
<span class="sd">                          | DOLLAR_LBRACKET any_raw_toks_opt RBRACKET</span>
<span class="sd">                          | ATDOLLAR_LPAREN any_raw_toks_opt RPAREN</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nocomma_part_any</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nocomma_part : any_nested_raw&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nocomma_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nocomma : nocomma_part&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_nocomma_append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;nocomma : nocomma nocomma_part&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">p_comma_nocomma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_nocomma : comma_tok nocomma&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">p_macroarglist_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;macroarglist : nocomma&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">p_macroarglist_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;macroarglist : nocomma comma_nocomma_list&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_subscriptlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subscriptlist : subscript comma_subscript_list_opt comma_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Slice</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Slice</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p2</span><span class="p">]):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ExtSlice</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p2</span><span class="p">],</span>
                <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span>

    <span class="k">def</span> <span class="nf">p_comma_subscript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_subscript : COMMA subscript&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_subscript_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subscript : test&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subscript_tok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subscript : test_opt colon_tok test_opt sliceop_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Slice</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_sliceop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sliceop : COLON test_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_expr_or_star_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;expr_or_star_expr : expr</span>
<span class="sd">                             | star_expr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_comma_expr_or_star_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_expr_or_star_expr : COMMA expr_or_star_expr&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_exprlist_e3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;exprlist : expr_or_star_expr comma_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_exprlist_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;exprlist : expr_or_star_expr comma_expr_or_star_expr_list comma_opt&quot;&quot;&quot;</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p2</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p2</span>

    <span class="k">def</span> <span class="nf">p_testlist_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;testlist : test&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="s2">&quot;_real_tuple&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p1</span><span class="o">.</span><span class="n">_real_tuple</span> <span class="ow">and</span> <span class="n">p1</span><span class="o">.</span><span class="n">elts</span>
        <span class="p">):</span>
            <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">elts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span>

    <span class="k">def</span> <span class="nf">p_testlist_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;testlist : test COMMA&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="s2">&quot;_real_tuple&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p1</span><span class="o">.</span><span class="n">_real_tuple</span>
        <span class="p">):</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensure_has_elts</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">p_testlist_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;testlist : test comma_test_list COMMA</span>
<span class="sd">                    | test comma_test_list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="s2">&quot;_real_tuple&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p1</span><span class="o">.</span><span class="n">_real_tuple</span>
        <span class="p">):</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span>
                <span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">ensure_has_elts</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">elts</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span>

    <span class="k">def</span> <span class="nf">p_comma_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_item : COMMA item&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1">#</span>
    <span class="c1"># Dict or set maker</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="nf">p_dictorsetmaker_t6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dictorsetmaker : test COLON test comma_item_list comma_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p4</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_dictorsetmaker_i4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dictorsetmaker : item comma_item_list comma_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p2</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_dictorsetmaker_t4_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dictorsetmaker : test COLON testlist&quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_or_elts_if_not_real_tuple</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lopen_loc</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_dictorsetmaker_t4_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dictorsetmaker : test_or_star_expr comma_test_or_star_expr_list comma_opt&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span>
            <span class="n">elts</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_dictorsetmaker_test_comma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dictorsetmaker : test_or_star_expr comma_opt&quot;&quot;&quot;</span>
        <span class="n">elts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_or_elts_if_not_real_tuple</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span>
            <span class="n">elts</span><span class="o">=</span><span class="n">elts</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_dictorsetmaker_testlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dictorsetmaker : testlist&quot;&quot;&quot;</span>
        <span class="n">elts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_or_elts_if_not_real_tuple</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span>
            <span class="n">elts</span><span class="o">=</span><span class="n">elts</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_dictorsetmaker_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dictorsetmaker : item comp_for</span>
<span class="sd">                          | test_or_star_expr comp_for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">comps</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comps&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">DictComp</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">value</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">generators</span><span class="o">=</span><span class="n">comps</span><span class="p">,</span>
                <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">SetComp</span><span class="p">(</span>
                <span class="n">elt</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">generators</span><span class="o">=</span><span class="n">comps</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_classdef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;classdef : class_tok NAME func_call_opt COLON suite&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">p3</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">p3</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">],</span> <span class="n">p3</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">])</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">bases</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
            <span class="n">keywords</span><span class="o">=</span><span class="n">kw</span><span class="p">,</span>
            <span class="n">starargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
            <span class="n">decorator_list</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_comma_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comma_argument : COMMA argument&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_comp_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comp_iter : comp_for</span>
<span class="sd">                     | comp_if</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_comp_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comp_for : FOR exprlist IN or_test comp_iter_opt&quot;&quot;&quot;</span>
        <span class="n">targs</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">p5</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">targs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">targ</span> <span class="o">=</span> <span class="n">targs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">targ</span> <span class="o">=</span> <span class="n">ensure_has_elts</span><span class="p">(</span><span class="n">targs</span><span class="p">)</span>
        <span class="n">store_ctx</span><span class="p">(</span><span class="n">targ</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">comprehension</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">targ</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="n">it</span><span class="p">,</span> <span class="n">ifs</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">comps</span> <span class="o">=</span> <span class="p">[</span><span class="n">comp</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;comps&quot;</span><span class="p">:</span> <span class="n">comps</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">p5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">comps</span> <span class="o">+=</span> <span class="n">p5</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comps&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">comp</span><span class="o">.</span><span class="n">ifs</span> <span class="o">+=</span> <span class="n">p5</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;if&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_comp_if</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;comp_if : IF test_nocond comp_iter_opt&quot;&quot;&quot;</span>
        <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">p2</span><span class="p">]}</span>
        <span class="k">if</span> <span class="n">p3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span><span class="p">[</span><span class="s2">&quot;comps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comps&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_yield_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;yield_expr : yield_tok yield_arg_opt&quot;&quot;&quot;</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p2</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">YieldFrom</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">p2</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_yield_arg_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;yield_arg : FROM test&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>

    <span class="k">def</span> <span class="nf">p_yield_arg_testlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;yield_arg : testlist&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>

    <span class="c1">#</span>
    <span class="c1"># subprocess</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">_dollar_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;These handle the special xonsh $ shell atoms by looking up</span>
<span class="sd">        in a special __xonsh__.env dictionary injected in the __builtin__.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lenp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">LexToken</span><span class="p">):</span>
            <span class="n">p1</span><span class="p">,</span> <span class="n">p1_tok</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">p1</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">p1_tok</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1_tok</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span>
        <span class="k">if</span> <span class="n">lenp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># $NAME</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_envvar_by_name</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p1</span> <span class="o">==</span> <span class="s2">&quot;${&quot;</span><span class="p">:</span>
            <span class="n">xenv</span> <span class="o">=</span> <span class="n">load_attribute_chain</span><span class="p">(</span><span class="s2">&quot;__xonsh__.env&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">p2</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">(</span>
                <span class="n">value</span><span class="o">=</span><span class="n">xenv</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">p1</span> <span class="o">==</span> <span class="s2">&quot;$(&quot;</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.subproc_captured_stdout&quot;</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">p1</span> <span class="o">==</span> <span class="s2">&quot;!(&quot;</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.subproc_captured_object&quot;</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">p1</span> <span class="o">==</span> <span class="s2">&quot;![&quot;</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.subproc_captured_hiddenobject&quot;</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">p1</span> <span class="o">==</span> <span class="s2">&quot;$[&quot;</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span><span class="s2">&quot;__xonsh__.subproc_uncaptured&quot;</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">_envvar_getter_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">xenv</span> <span class="o">=</span> <span class="n">load_attribute_chain</span><span class="p">(</span><span class="s2">&quot;__xonsh__.env&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">xenv</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">),</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">starargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_envvar_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Looks up a xonsh variable by name.&quot;&quot;&quot;</span>
        <span class="n">xenv</span> <span class="o">=</span> <span class="n">load_attribute_chain</span><span class="p">(</span><span class="s2">&quot;__xonsh__.env&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">xenv</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_subproc_cliargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates an expression for subprocess CLI arguments.&quot;&quot;&quot;</span>
        <span class="n">cliargs</span> <span class="o">=</span> <span class="n">currlist</span> <span class="o">=</span> <span class="n">empty_list</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">_cliarg_action</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">currlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">currlist</span> <span class="o">=</span> <span class="n">empty_list</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">cliargs</span> <span class="o">=</span> <span class="n">binop</span><span class="p">(</span>
                        <span class="n">cliargs</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">(),</span> <span class="n">currlist</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span>
                    <span class="p">)</span>
                <span class="n">currlist</span><span class="o">.</span><span class="n">elts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;extend&quot;</span><span class="p">:</span>
                <span class="n">cliargs</span> <span class="o">=</span> <span class="n">binop</span><span class="p">(</span><span class="n">cliargs</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">(),</span> <span class="n">arg</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                <span class="n">currlist</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;splitlines&quot;</span><span class="p">:</span>
                <span class="n">sl</span> <span class="o">=</span> <span class="n">call_split_lines</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                <span class="n">cliargs</span> <span class="o">=</span> <span class="n">binop</span><span class="p">(</span><span class="n">cliargs</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">(),</span> <span class="n">sl</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                <span class="n">currlist</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;ensure_list&quot;</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">ensure_list_from_str_or_list</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                <span class="n">cliargs</span> <span class="o">=</span> <span class="n">binop</span><span class="p">(</span><span class="n">cliargs</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">(),</span> <span class="n">x</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                <span class="n">currlist</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;action not understood: &quot;</span> <span class="o">+</span> <span class="n">action</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">arg</span><span class="o">.</span><span class="n">_cliarg_action</span>
        <span class="k">return</span> <span class="n">cliargs</span>

    <span class="k">def</span> <span class="nf">p_pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;pipe : PIPE</span>
<span class="sd">                | WS PIPE</span>
<span class="sd">                | PIPE WS</span>
<span class="sd">                | WS PIPE WS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subproc_s2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc : subproc_atoms</span>
<span class="sd">                   | subproc_atoms WS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_subproc_cliargs</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">p_subproc_amp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc : subproc AMPERSAND&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">p_subproc_pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc : subproc pipe subproc_atoms</span>
<span class="sd">                   | subproc pipe subproc_atoms WS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p1</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">s</span> <span class="o">!=</span> <span class="s2">&quot;|&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;additional redirect following non-pipe redirect&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currloc</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">))</span>
        <span class="n">cliargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subproc_cliargs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cliargs</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_subproc_atoms_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atoms : subproc_atom&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">p_subproc_atoms_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atoms : subproc_atoms WS subproc_atom&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span>

    <span class="k">def</span> <span class="nf">p_subproc_atoms_subshell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atoms : lparen_tok any_raw_tok rparen_tok</span>
<span class="sd">                         | lparen_tok any_raw_toks rparen_tok</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">subcmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_slice</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="p">(</span><span class="n">p3</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">lexpos</span><span class="p">))</span>
        <span class="n">subcmd</span> <span class="o">=</span> <span class="n">subcmd</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;xonsh&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">c</span><span class="p">),</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">c</span><span class="p">),</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">subcmd</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">c</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">p0</span><span class="p">:</span>
            <span class="n">arg</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;append&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="c1">#</span>
    <span class="c1"># Subproc atom rules</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="nf">_append_subproc_bang_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Appends an empty string in subprocess mode to the argument list.&quot;&quot;&quot;</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p3</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p3</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">elts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_append_subproc_bang</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Appends the part between ! and the ) or ] in subprocess mode to the</span>
<span class="sd">        argument list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p3</span><span class="p">,</span> <span class="n">p5</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">beg</span> <span class="o">=</span> <span class="p">(</span><span class="n">p3</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">lexpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">p5</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p5</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_slice</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">beg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">beg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">elts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_uncaptured</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : dollar_lbracket_tok subproc RBRACKET&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
            <span class="s2">&quot;__xonsh__.subproc_uncaptured&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;splitlines&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_uncaptured_bang_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : dollar_lbracket_tok subproc bang_tok RBRACKET&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_subproc_bang_empty</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_subproc_atom_uncaptured</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_uncaptured_bang</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : dollar_lbracket_tok subproc bang_tok nocloser rbracket_tok&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_subproc_bang</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_subproc_atom_uncaptured</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_captured_stdout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : dollar_lparen_tok subproc RPAREN&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
            <span class="s2">&quot;__xonsh__.subproc_captured_stdout&quot;</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;append&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_captured_stdout_bang_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : dollar_lparen_tok subproc bang_tok RPAREN&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_subproc_bang_empty</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_subproc_atom_captured_stdout</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_captured_stdout_bang</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : dollar_lparen_tok subproc bang_tok nocloser rparen_tok&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_subproc_bang</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_subproc_atom_captured_stdout</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_pyenv_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : dollar_lbrace_tok test RBRACE&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lineno</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="n">xenv</span> <span class="o">=</span> <span class="n">load_attribute_chain</span><span class="p">(</span><span class="s2">&quot;__xonsh__.env&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">xenv</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span>
        <span class="p">)</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">)],</span>
            <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">starargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col_offset</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;append&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_pyeval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : at_lparen_tok testlist_comp RPAREN</span>
<span class="sd">           subproc_arg_part : at_lparen_tok testlist_comp RPAREN</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
            <span class="s2">&quot;__xonsh__.list_of_strs_or_callables&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;extend&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_subproc_inject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : atdollar_lparen_tok subproc RPAREN&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
            <span class="s2">&quot;__xonsh__.subproc_captured_inject&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span>
        <span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;extend&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_subproc_inject_bang_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : atdollar_lparen_tok subproc bang_tok RPAREN&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_subproc_bang_empty</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_subproc_atom_subproc_inject</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_subproc_inject_bang</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : atdollar_lparen_tok subproc bang_tok nocloser rparen_tok&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_subproc_bang</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_subproc_atom_subproc_inject</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : GT</span>
<span class="sd">                        | LT</span>
<span class="sd">                        | RSHIFT</span>
<span class="sd">                        | IOREDIRECT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;append&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_re</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : SEARCHPATH&quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_pathsearch</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pymode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;extend&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : string_literal&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;is_raw&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">is_raw</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.expand_path&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span>
            <span class="p">)</span>
        <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;append&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_atom_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_atom : subproc_arg&quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># has an expanding function call, such as @(x)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.list_of_list_of_strs_outer_product&quot;</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ensure_has_elts</span><span class="p">(</span><span class="n">p1</span><span class="p">)],</span>
                <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;extend&quot;</span>
        <span class="k">elif</span> <span class="n">hasglobstar</span><span class="p">(</span><span class="n">p1</span><span class="p">):</span>
            <span class="c1"># globbed literal argument</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.glob&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
            <span class="p">)</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;extend&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># literal str argument</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">xonsh_call</span><span class="p">(</span>
                <span class="s2">&quot;__xonsh__.expand_path&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">p1</span><span class="p">],</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span>
            <span class="p">)</span>
            <span class="n">p0</span><span class="o">.</span><span class="n">_cliarg_action</span> <span class="o">=</span> <span class="s2">&quot;append&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">p_subproc_arg_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_arg : subproc_arg_part&quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">p_subproc_arg_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subproc_arg : subproc_arg subproc_arg_part&quot;&quot;&quot;</span>
        <span class="c1"># This glues the string together after parsing</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">):</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">s</span> <span class="o">+</span> <span class="n">p2</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">col_offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">p1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">p2</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span>

    <span class="k">def</span> <span class="nf">_attach_subproc_arg_part_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">toks</span> <span class="o">-=</span> <span class="p">{</span>
            <span class="s2">&quot;AND&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NOT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PIPE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;WS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LSHIFT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RSHIFT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IOREDIRECT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SEARCHPATH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;INDENT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DEDENT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AT_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BANG_LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LPAREN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LBRACE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOLLAR_LBRACKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATDOLLAR_LPAREN&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">                 | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_tok&quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">]))</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;subproc_arg_part : &quot;</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_subproc_arg_part</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="k">def</span> <span class="nf">p_subproc_arg_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="c1"># Many tokens cannot be part of this rule, such as $, &#39;, &quot;, ()</span>
        <span class="c1"># Use a string atom instead. See above attachment functions</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Helpers</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">p_test_comma_combine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;test_comma_list : test comma_test_list</span>
<span class="sd">                           | test comma_test_list COMMA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p2</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p2</span>

    <span class="k">def</span> <span class="nf">p_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="s2">&quot;empty : &quot;</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">p_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span><span class="s2">&quot;no further code&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ERRORTOKEN&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currloc</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lexpos</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;code: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">),)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currloc</span><span class="p">(</span><span class="n">lineno</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">lexpos</span><span class="p">))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../../../sidebar.html" title="sidebar">
          <img class="logo" src="../../../_static/ascii_conch_part_transparent_tight.png" alt="Logo"/>
        </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../../sidebar.html">xonsh 0.9.5.dev135 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Anthony Scopatz.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>